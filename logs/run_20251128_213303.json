{
  "timestamp": "20251128_213303",
  "query": "Analyze ROAS drop",
  "plan": {
    "query_info": {
      "raw_query": "Analyze ROAS drop",
      "intent": "analyze_roas",
      "created_at": "2025-11-28T21:32:58.891439Z"
    },
    "dataset_meta": {
      "n_rows": 2250,
      "date_min": "2025-01-01",
      "date_max": "2025-03-31",
      "n_campaigns": 219,
      "n_adsets": 25,
      "n_creatives": 224
    },
    "campaign_filter": null,
    "tasks": [
      {
        "id": "T1",
        "type": "data_load_summary",
        "agent": "data_agent",
        "params": {
          "sample": "auto"
        },
        "depends_on": [],
        "description": "Load CSV, validate columns, compute core summary aggregates (daily, campaign, creative)."
      },
      {
        "id": "T2",
        "type": "insight_generation",
        "agent": "insight_agent",
        "params": {
          "intent": "analyze_roas",
          "initial_scope": "account_and_campaign",
          "roas_drop_threshold_pct": -20,
          "low_ctr_threshold": 0.02,
          "min_impressions_for_stats": 1000,
          "recent_window_days": 14,
          "previous_window_days": 14
        },
        "depends_on": [
          "T1"
        ],
        "description": "Generate hypotheses using summarized data (Think \u2192 Analyze \u2192 Conclude)."
      },
      {
        "id": "T3",
        "type": "metric_evaluation",
        "agent": "metric_evaluator",
        "params": {
          "recent_window_days": 14,
          "previous_window_days": 14
        },
        "depends_on": [
          "T2"
        ],
        "description": "Validate numeric hypotheses using tests (bootstrap/proportion tests), compute metric_confidence."
      },
      {
        "id": "T4",
        "type": "creative_evaluation",
        "agent": "creative_evaluator",
        "params": {
          "chs_weights": {
            "behavior": 0.5,
            "text": 0.3,
            "fatigue": 0.2
          }
        },
        "depends_on": [
          "T1"
        ],
        "description": "Compute Creative Health Score (CHS) per campaign and component deltas."
      },
      {
        "id": "T5",
        "type": "creative_generation",
        "agent": "creative_generator",
        "params": {
          "variants_per_type": 3,
          "target": "low_ctr_or_low_chs"
        },
        "depends_on": [
          "T3",
          "T4"
        ],
        "description": "Produce candidate creatives for low-CTR or low-CHS campaigns; include meta tags for targeted CHS component."
      },
      {
        "id": "T6",
        "type": "final_aggregation",
        "agent": "orchestrator",
        "params": {
          "outputs": [
            "insights.json",
            "creatives.json",
            "report.md"
          ]
        },
        "depends_on": [
          "T3",
          "T4",
          "T5"
        ],
        "description": "Aggregate evaluated hypotheses, compute final_confidences, create outputs and logs."
      }
    ],
    "plan_created_at": "2025-11-28T21:32:58.891439Z",
    "config": {
      "recent_window_days": 14,
      "previous_window_days": 14,
      "roas_drop_threshold_pct": -20,
      "low_ctr_threshold": 0.02,
      "min_impressions_for_stats": 1000,
      "max_retries": 2,
      "reflection_confidence_thresh": 0.4
    }
  },
  "reflection": {
    "retry": true,
    "reason": "No high-confidence hypotheses; suggest widening time windows and requesting segment-level analysis.",
    "new_tasks": [
      {
        "id": "T2b",
        "type": "insight_generation",
        "agent": "insight_agent",
        "params": {
          "intent": "wider_analysis",
          "recent_window_days": 28
        },
        "depends_on": [
          "T1"
        ],
        "description": "Retry insight generation with wider window and deeper segmentation."
      }
    ]
  },
  "outputs": {
    "insights_path": "outputs\\insights.json",
    "creatives_path": "outputs\\creatives.json",
    "report_path": "outputs\\report.md"
  }
}